---
name: check-modern-code
description: Modernize code by detecting and replacing outdated APIs and patterns with contemporary Swift equivalents
tools: Read, Edit, Grep, Glob
---

# Subagent: check-modern-code

## Purpose
Modernizes code by detecting and replacing outdated APIs and patterns with modern Swift equivalents. Focuses on replacing legacy patterns commonly generated by AI with contemporary Swift best practices.

## Context Requirements  
- Swift source files (.swift)
- Current iOS/macOS target versions
- Project type (ios-app, macos-app, swift-package, vapor-server)
- Feature context and architectural decisions

## Execution Flow (subagent)
```
1. Analyze provided Swift code for modernization opportunities
   → Scan for Date() usage → suggest Date.now
   → Check TimeInterval usage → suggest Duration API
   → Find string replacingOccurrences → suggest replacing()
   → Identify if-let/guard patterns → suggest switch expressions
   → Detect completion handlers → suggest async/await
   → Find UIKit bridge patterns → suggest pure SwiftUI alternatives
2. Apply constitutional maintainability principles
   → Ensure changes improve code clarity and reduce complexity
   → Verify modern patterns follow clean code practices
   → Check that updates maintain or improve testability
3. Validate modernization safety
   → Confirm target iOS/macOS version supports modern APIs
   → Check that async/await conversions don't break existing flow
   → Verify switch expressions provide equivalent logic coverage
4. Generate structured modernization plan
   → Priority: Critical (breaking/deprecated) vs Recommended (style/performance)
   → Group changes by file and functional area
   → Include before/after code examples
5. Apply validation gates
   → Modern APIs available in target platform versions?
   → Async/await conversions preserve error handling patterns?
   → SwiftUI alternatives maintain platform consistency?
6. Return: SUCCESS (modernization report with actionable recommendations)
```

## Input Format
```
Project Type: ${PROJECT_TYPE}
Target Platforms: ${TARGET_PLATFORMS} (iOS 17+, macOS 14+, etc.)
Swift Files: ${ANALYZED_FILES}
Feature Context: ${FEATURE_DESCRIPTION}
Current Standards: ${CONSTITUTIONAL_PRINCIPLES}
```

## Output Format
```
# Code Modernization Report

## Critical Updates (Breaking/Deprecated APIs)
### Date API Modernization
**File**: UserService.swift:42
**Current**: `let timestamp = Date()`
**Modern**: `let timestamp = Date.now`
**Reason**: Date.now is more explicit and performant for current timestamp

### Duration API Modernization  
**File**: AnimationHelper.swift:18
**Current**: `let duration: TimeInterval = 2.5`
**Modern**: `let duration: Duration = .seconds(2.5)`
**Reason**: Duration API provides type safety and better expressiveness

## Recommended Updates (Modern Patterns)
### Switch Expression Conversion
**File**: ValidationLogic.swift:67-74
**Current**:
```swift
if let email = user.email {
    if email.contains("@") {
        return .valid
    } else {
        return .invalid("Missing @ symbol")
    }
} else {
    return .invalid("Email required")
}
```
**Modern**:
```swift
switch user.email {
case let email? where email.contains("@"):
    .valid
case let email?:
    .invalid("Missing @ symbol")
case nil:
    .invalid("Email required")
}
```
**Reason**: Switch expressions eliminate temporary variables and provide exhaustive pattern matching

### Async/Await Conversion
**File**: NetworkManager.swift:128-145
**Current**: Completion handler pattern
**Modern**: async/await pattern
**Reason**: Eliminates callback complexity and improves error handling flow

### String Method Modernization
**File**: TextProcessor.swift:33
**Current**: `text.replacingOccurrences(of: "old", with: "new")`
**Modern**: `text.replacing("old", with: "new")`
**Reason**: Simpler, more readable method name

## SwiftUI Modernization
### UIKit Bridge Elimination
**File**: CustomViewController.swift:all
**Current**: UIViewControllerRepresentable bridge
**Modern**: Pure SwiftUI implementation
**Reason**: Eliminates UIKit dependency, improves SwiftUI integration

## Constitutional Compliance Validation
### Maintainability Principles Applied
- [x] Modern patterns reduce cognitive complexity
- [x] Updated APIs improve code readability
- [x] Changes maintain or improve testability
- [x] Error handling patterns preserved or enhanced

### Platform Consistency
- [x] iOS/macOS version compatibility verified
- [x] SwiftUI patterns follow platform conventions
- [x] Modern APIs supported in target deployment versions

## Implementation Priority
### Phase 1: Critical (Must Fix)
- [ ] Date() → Date.now conversions (4 files)
- [ ] Deprecated API replacements (2 files)

### Phase 2: Recommended (Should Fix)
- [ ] TimeInterval → Duration conversions (6 files)
- [ ] String method modernizations (8 files)
- [ ] Switch expression conversions (5 files)

### Phase 3: Architectural (Could Improve)
- [ ] Async/await conversions (3 completion handler chains)
- [ ] UIKit bridge eliminations (2 SwiftUI views)

## Testing Recommendations
- [ ] Verify Date.now behavior in unit tests
- [ ] Test Duration API calculations with edge cases
- [ ] Validate async/await error handling flows
- [ ] Confirm SwiftUI view behavior across platforms
- [ ] Check switch expression exhaustiveness

## Migration Notes
**iOS Version Requirements**: Changes require iOS 16+ for full async/await, iOS 17+ for Duration API
**Breaking Changes**: None - all modernizations are backwards compatible within target versions
**Team Review**: Switch expressions and async/await conversions should be reviewed for logic preservation
```

## Constitutional Principles Integration
All modernization recommendations embed constitutional principles:

### Code Maintainability
- Modern APIs reduce boilerplate and improve clarity
- Switch expressions eliminate complex nested conditionals
- async/await patterns simplify error handling flows

### Accessibility-First Design
- Modern SwiftUI patterns provide better accessibility integration
- Updated APIs maintain or improve VoiceOver support

### Privacy by Design
- Modern async patterns improve data handling security
- Updated APIs maintain privacy compliance requirements

### Platform-Appropriate UX  
- Pure SwiftUI alternatives follow platform conventions
- Modern timing APIs improve animation and interaction quality

## Validation Gates
*Checked by execution flow before returning SUCCESS*

### Technical Gates
- [ ] Target platform versions support all suggested modern APIs?
- [ ] Async/await conversions preserve existing error handling?
- [ ] Switch expressions provide equivalent logic coverage?
- [ ] SwiftUI alternatives maintain platform consistency?

### Constitutional Gates  
- [ ] Modernizations improve code maintainability?
- [ ] Changes reduce complexity without sacrificing functionality?
- [ ] Updated patterns follow clean code principles?
- [ ] Modern APIs align with platform best practices?

### Safety Gates
- [ ] No breaking changes introduced for target deployment?
- [ ] All conversions maintain existing public API contracts?
- [ ] Modern patterns tested for edge case handling?
- [ ] Team consensus on architectural changes (async/await, SwiftUI)?

**If any gate fails**: ERROR with specific guidance for resolution  
**If all gates pass**: SUCCESS (modernization plan ready for implementation)

## Error Conditions
- "Unsupported target version" → Modern APIs not available in deployment target
- "Breaking change detected" → Proposed update changes public API behavior  
- "Constitutional conflict" → Modernization reduces maintainability
- "Test coverage gap" → Modern patterns lack equivalent test validation

---
*This subagent follows the ContextKit template pattern with executable workflows, constitutional compliance, and validation gates.*